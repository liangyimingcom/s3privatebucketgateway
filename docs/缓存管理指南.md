# ç¼“å­˜ç®¡ç†æŒ‡å—

## ğŸš€ å¿«é€Ÿè§£å†³å†…å®¹ä¸åˆ·æ–°é—®é¢˜

### å½“å‰é…ç½®
- **ç¼“å­˜TTL**: 60ç§’ï¼ˆ1åˆ†é’Ÿï¼‰
- **è‡ªåŠ¨åˆ·æ–°**: å†…å®¹ä¼šåœ¨1åˆ†é’Ÿåè‡ªåŠ¨æ›´æ–°
- **æœåŠ¡åœ°å€**: http://ä½ çš„å®ä¾‹IP

### ç«‹å³åˆ·æ–°æ–¹æ³•

#### æ–¹æ³•1: æ¸…é™¤æ‰€æœ‰ç¼“å­˜ï¼ˆæ¨èï¼‰
```bash
curl http://ä½ çš„å®ä¾‹IP/admin/cache/clear
```

#### æ–¹æ³•2: å¼ºåˆ¶åˆ·æ–°ç‰¹å®šé¡µé¢
```bash
# åœ¨URLåæ·»åŠ  ?refresh=1
curl http://ä½ çš„å®ä¾‹IP/website1/index.html?refresh=1
curl http://ä½ çš„å®ä¾‹IP/app1?refresh=1
```

#### æ–¹æ³•3: æŸ¥çœ‹ç¼“å­˜çŠ¶æ€
```bash
curl http://ä½ çš„å®ä¾‹IP/admin/cache/status
```

#### æ–¹æ³•4: SSHç›´æ¥æ¸…é™¤
```bash
ssh -i ä½ çš„å¯†é’¥å¯¹.pem ec2-user@ä½ çš„å®ä¾‹IP "sudo rm -rf /var/cache/s3-proxy/*"
```

### ç¼“å­˜çŠ¶æ€è¯´æ˜

```json
{
    "cache_ttl": 60,           // ç¼“å­˜æœ‰æ•ˆæœŸï¼ˆç§’ï¼‰
    "total_files": 2,          // ç¼“å­˜æ–‡ä»¶æ€»æ•°
    "files": [
        {
            "file": "website1_index.html",
            "size": 743,           // æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
            "age_seconds": 45,     // ç¼“å­˜å¹´é¾„ï¼ˆç§’ï¼‰
            "valid": true          // æ˜¯å¦æœ‰æ•ˆï¼ˆage < ttlï¼‰
        }
    ]
}
```

### å·¥ä½œæµç¨‹

1. **æ›´æ–°S3å†…å®¹** â†’ ä¸Šä¼ æ–°æ–‡ä»¶åˆ°S3æ¡¶
2. **é€‰æ‹©åˆ·æ–°æ–¹å¼**:
   - ç­‰å¾…60ç§’è‡ªåŠ¨åˆ·æ–° â°
   - æˆ–ä½¿ç”¨ä¸Šè¿°ä»»ä¸€æ–¹æ³•ç«‹å³åˆ·æ–° âš¡
3. **éªŒè¯æ›´æ–°** â†’ è®¿é—®é¡µé¢ç¡®è®¤å†…å®¹å·²æ›´æ–°

### å¸¸ç”¨å‘½ä»¤ç»„åˆ

```bash
# æ›´æ–°åç«‹å³éªŒè¯
curl http://ä½ çš„å®ä¾‹IP/admin/cache/clear && \
curl http://ä½ çš„å®ä¾‹IP/website1

# æ£€æŸ¥ç‰¹å®šæ–‡ä»¶ç¼“å­˜çŠ¶æ€
curl -s http://ä½ çš„å®ä¾‹IP/admin/cache/status | \
python3 -c "import sys,json; [print(f'{f[\"file\"]}: {f[\"age_seconds\"]}s ({'æœ‰æ•ˆ' if f['valid'] else 'å·²è¿‡æœŸ'})') for f in json.load(sys.stdin)['files']]"
```

### æ•…éšœæ’é™¤

å¦‚æœå†…å®¹ä»ä¸æ›´æ–°ï¼š
1. ç¡®è®¤S3æ–‡ä»¶ç¡®å®å·²æ›´æ–°
2. æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š`curl http://ä½ çš„å®ä¾‹IP/health`
3. æŸ¥çœ‹æœåŠ¡æ—¥å¿—ï¼š`ssh ... "sudo journalctl -u s3-proxy -n 20"`
4. é‡å¯æœåŠ¡ï¼š`ssh ... "sudo systemctl restart s3-proxy"`

---
**æç¤º**: ç°åœ¨ç¼“å­˜TTLåªæœ‰1åˆ†é’Ÿï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ç­‰å¾…1åˆ†é’Ÿå³å¯çœ‹åˆ°æ›´æ–°ï¼
