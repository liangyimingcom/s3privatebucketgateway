# 缓存管理指南

## 🚀 快速解决内容不刷新问题

### 当前配置
- **缓存TTL**: 60秒（1分钟）
- **自动刷新**: 内容会在1分钟后自动更新
- **服务地址**: http://你的实例IP

### 立即刷新方法

#### 方法1: 清除所有缓存（推荐）
```bash
curl http://你的实例IP/admin/cache/clear
```

#### 方法2: 强制刷新特定页面
```bash
# 在URL后添加 ?refresh=1
curl http://你的实例IP/website1/index.html?refresh=1
curl http://你的实例IP/app1?refresh=1
```

#### 方法3: 查看缓存状态
```bash
curl http://你的实例IP/admin/cache/status
```

#### 方法4: SSH直接清除
```bash
ssh -i 你的密钥对.pem ec2-user@你的实例IP "sudo rm -rf /var/cache/s3-proxy/*"
```

### 缓存状态说明

```json
{
    "cache_ttl": 60,           // 缓存有效期（秒）
    "total_files": 2,          // 缓存文件总数
    "files": [
        {
            "file": "website1_index.html",
            "size": 743,           // 文件大小（字节）
            "age_seconds": 45,     // 缓存年龄（秒）
            "valid": true          // 是否有效（age < ttl）
        }
    ]
}
```

### 工作流程

1. **更新S3内容** → 上传新文件到S3桶
2. **选择刷新方式**:
   - 等待60秒自动刷新 ⏰
   - 或使用上述任一方法立即刷新 ⚡
3. **验证更新** → 访问页面确认内容已更新

### 常用命令组合

```bash
# 更新后立即验证
curl http://你的实例IP/admin/cache/clear && \
curl http://你的实例IP/website1

# 检查特定文件缓存状态
curl -s http://你的实例IP/admin/cache/status | \
python3 -c "import sys,json; [print(f'{f[\"file\"]}: {f[\"age_seconds\"]}s ({'有效' if f['valid'] else '已过期'})') for f in json.load(sys.stdin)['files']]"
```

### 故障排除

如果内容仍不更新：
1. 确认S3文件确实已更新
2. 检查服务状态：`curl http://你的实例IP/health`
3. 查看服务日志：`ssh ... "sudo journalctl -u s3-proxy -n 20"`
4. 重启服务：`ssh ... "sudo systemctl restart s3-proxy"`

---
**提示**: 现在缓存TTL只有1分钟，大多数情况下等待1分钟即可看到更新！
