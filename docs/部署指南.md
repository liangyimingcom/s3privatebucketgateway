# éƒ¨ç½²æŒ‡å—

## ğŸ¯ æ¦‚è¿°

æœ¬æŒ‡å—æä¾›åœ¨ä»»ä½•AWSè´¦å·ä¸­éƒ¨ç½²ã€ŠS3ç§æœ‰æ¡¶ç½‘å…³ä»£ç†ä¸å­ç›®å½•çº§404é‡å®šå‘ã€‹çš„è¯¦ç»†è¯´æ˜ã€‚

## ğŸ“‹ å‰ç½®æ¡ä»¶

### AWSè¦æ±‚
- å·²å®‰è£…å¹¶é…ç½®AWS CLI
- å…·å¤‡é€‚å½“æƒé™çš„AWSè´¦å·
- ç›®æ ‡åŒºåŸŸä¸­çš„EC2å¯†é’¥å¯¹

### æ‰€éœ€AWSæƒé™
```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "cloudformation:*",
                "ec2:*",
                "s3:*",
                "iam:*"
            ],
            "Resource": "*"
        }
    ]
}
```

### æœ¬åœ°è¦æ±‚
- Bash shell (Linux/macOS/WSL)
- Git (ç”¨äºå…‹éš†ä»“åº“)
- äº’è”ç½‘è¿æ¥

## ğŸš€ éƒ¨ç½²æ–¹æ³•

### æ–¹æ³•1: ä¸€é”®è„šæœ¬éƒ¨ç½² (æ¨è)

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/your-username/s3-private-gateway-proxy.git
cd s3-private-gateway-proxy

# ä½¿ç”¨é»˜è®¤è®¾ç½®éƒ¨ç½²
./deploy.sh æˆ‘çš„å †æ ˆåç§° æˆ‘çš„å¯†é’¥å¯¹åç§° us-east-1

# ä½¿ç”¨è‡ªå®šä¹‰å®ä¾‹ç±»å‹éƒ¨ç½²
./deploy.sh æˆ‘çš„å †æ ˆåç§° æˆ‘çš„å¯†é’¥å¯¹åç§° us-east-1 t3.large
```

### æ–¹æ³•2: AWS CLIç›´æ¥éƒ¨ç½²

```bash
aws cloudformation deploy \
  --template-file infrastructure/cloudformation-template.yaml \
  --stack-name s3-private-gateway-proxy \
  --parameter-overrides \
    KeyPairName=æˆ‘çš„å¯†é’¥å¯¹ \
    ProjectName=s3-gateway \
    InstanceType=t3.medium \
  --capabilities CAPABILITY_NAMED_IAM \
  --region us-east-1
```

### æ–¹æ³•3: AWSæ§åˆ¶å°éƒ¨ç½²

1. æ‰“å¼€AWS CloudFormationæ§åˆ¶å°
2. ç‚¹å‡»"åˆ›å»ºå †æ ˆ" â†’ "ä½¿ç”¨æ–°èµ„æº"
3. ä¸Šä¼  `infrastructure/cloudformation-template.yaml`
4. å¡«å†™å‚æ•°:
   - **å †æ ˆåç§°**: `s3-private-gateway-proxy`
   - **KeyPairName**: æ‚¨çš„EC2å¯†é’¥å¯¹åç§°
   - **ProjectName**: `s3-gateway`
   - **InstanceType**: `t3.medium`
5. å‹¾é€‰"æˆ‘ç¡®è®¤AWS CloudFormationå¯èƒ½åˆ›å»ºIAMèµ„æº"
6. ç‚¹å‡»"åˆ›å»ºå †æ ˆ"

## âš™ï¸ é…ç½®å‚æ•°

### å¿…éœ€å‚æ•°

| å‚æ•° | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| `KeyPairName` | ç”¨äºSSHè®¿é—®çš„EC2å¯†é’¥å¯¹ | `æˆ‘çš„å¯†é’¥å¯¹` |

### å¯é€‰å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | æè¿° | é€‰é¡¹ |
|------|--------|------|------|
| `InstanceType` | `t3.medium` | EC2å®ä¾‹ç±»å‹ | `t3.micro`, `t3.small`, `t3.medium`, `t3.large` |
| `ProjectName` | `s3-gateway` | èµ„æºå‘½åå‰ç¼€ | ä»»ä½•å­—æ¯æ•°å­—å­—ç¬¦ä¸² |

## ğŸ—ï¸ åŸºç¡€è®¾æ–½ç»„ä»¶

### åˆ›å»ºçš„èµ„æº

| èµ„æºç±»å‹ | å‘½åæ¨¡å¼ | ç”¨é€” |
|----------|----------|------|
| **S3æ¡¶** | `{ProjectName}-{AccountId}-{Region}` | ç§æœ‰å†…å®¹å­˜å‚¨ |
| **EC2å®ä¾‹** | `{ProjectName}-instance` | åº”ç”¨æœåŠ¡å™¨ |
| **IAMè§’è‰²** | `{ProjectName}-ec2-role` | S3è®¿é—®æƒé™ |
| **å®‰å…¨ç»„** | `{ProjectName}-sg` | ç½‘ç»œè®¿é—®æ§åˆ¶ |
| **å®ä¾‹é…ç½®æ–‡ä»¶** | `{ProjectName}-instance-profile` | EC2-IAMé›†æˆ |

### ç½‘ç»œé…ç½®

- **VPC**: ä½¿ç”¨é»˜è®¤VPC
- **å­ç½‘**: ä½¿ç”¨é»˜è®¤å…¬æœ‰å­ç½‘
- **å®‰å…¨ç»„è§„åˆ™**:
  - SSH (22): 0.0.0.0/0
  - HTTP (80): 0.0.0.0/0
  - HTTPS (443): 0.0.0.0/0

## ğŸ“Š éƒ¨ç½²è¿‡ç¨‹

### é˜¶æ®µ1: åŸºç¡€è®¾æ–½ (2-3åˆ†é’Ÿ)
1. åˆ›å»ºå…·æœ‰ç§æœ‰è®¿é—®æƒé™çš„S3æ¡¶
2. åˆ›å»ºIAMè§’è‰²å’Œç­–ç•¥
3. åˆ›å»ºå®‰å…¨ç»„
4. å¯åŠ¨EC2å®ä¾‹

### é˜¶æ®µ2: åº”ç”¨è®¾ç½® (3-5åˆ†é’Ÿ)
1. å®‰è£…ç³»ç»ŸåŒ… (Nginx, Python, AWS CLI)
2. ä¸‹è½½å¹¶é…ç½®åº”ç”¨ç¨‹åº
3. ä¸Šä¼ ç¤ºä¾‹å†…å®¹åˆ°S3
4. å¯åŠ¨æœåŠ¡ (Nginx, S3-Proxy)

### é˜¶æ®µ3: éªŒè¯ (1åˆ†é’Ÿ)
1. å¥åº·æ£€æŸ¥ç«¯ç‚¹
2. åŸºç¡€åŠŸèƒ½æµ‹è¯•
3. é‡å®šå‘åŠŸèƒ½æµ‹è¯•

## ğŸ§ª éƒ¨ç½²åéªŒè¯

### è‡ªåŠ¨éªŒè¯

éƒ¨ç½²è„šæœ¬è‡ªåŠ¨éªŒè¯:

```bash
# å¥åº·æ£€æŸ¥
curl -f http://$PUBLIC_IP/health

# åŸºç¡€åŠŸèƒ½
curl -f http://$PUBLIC_IP/

# é‡å®šå‘åŠŸèƒ½
curl -I http://$PUBLIC_IP/website1/æµ‹è¯•404
```

### æ‰‹åŠ¨éªŒè¯

```bash
# è·å–éƒ¨ç½²è¾“å‡º
aws cloudformation describe-stacks \
  --stack-name ä½ çš„å †æ ˆåç§° \
  --region ä½ çš„åŒºåŸŸ \
  --query 'Stacks[0].Outputs'

# æµ‹è¯•æ‰€æœ‰ç«¯ç‚¹
PUBLIC_IP="ä½ çš„å®ä¾‹IP"

# å¥åº·æ£€æŸ¥
curl http://$PUBLIC_IP/health
# é¢„æœŸ: "OK"

# æ ¹é¡µé¢
curl http://$PUBLIC_IP/
# é¢„æœŸ: HTMLå†…å®¹

# å­ç›®å½•è®¿é—®
curl http://$PUBLIC_IP/website1/
# é¢„æœŸ: website1 HTMLå†…å®¹

# 404é‡å®šå‘æµ‹è¯•
curl -I http://$PUBLIC_IP/website1/ç¼ºå¤±é¡µé¢
# é¢„æœŸ: 200 OK å¸¦é‡å®šå‘å¤´

# ç¼“å­˜ç®¡ç†
curl http://$PUBLIC_IP/admin/cache/status
# é¢„æœŸ: JSONç¼“å­˜çŠ¶æ€
```

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹S3å†…å®¹

```bash
# ä»å †æ ˆè¾“å‡ºè·å–æ¡¶åç§°
BUCKET_NAME=$(aws cloudformation describe-stacks \
  --stack-name ä½ çš„å †æ ˆåç§° \
  --region ä½ çš„åŒºåŸŸ \
  --query 'Stacks[0].Outputs[?OutputKey==`BucketName`].OutputValue' \
  --output text)

# ä¸Šä¼ æ–°å†…å®¹
aws s3 cp æœ¬åœ°æ–‡ä»¶.html s3://$BUCKET_NAME/è·¯å¾„/
aws s3 sync æœ¬åœ°ç›®å½•/ s3://$BUCKET_NAME/å­ç›®å½•/

# æ¸…é™¤ç¼“å­˜ä»¥ç«‹å³æ›´æ–°
curl http://ä½ çš„IP/admin/cache/clear
```

### ä¿®æ”¹åº”ç”¨é…ç½®

```bash
# SSHåˆ°å®ä¾‹
ssh -i ä½ çš„å¯†é’¥å¯¹.pem ec2-user@ä½ çš„å®ä¾‹IP

# ç¼–è¾‘é…ç½®
sudo nano /opt/s3-proxy/s3-proxy.py

# é‡å¯æœåŠ¡
sudo systemctl restart s3-proxy
```

### æ·»åŠ SSL/TLS (æ‰‹åŠ¨)

```bash
# å®‰è£…certbot
sudo yum install -y certbot python3-certbot-nginx

# è·å–è¯ä¹¦ (éœ€è¦åŸŸå)
sudo certbot --nginx -d ä½ çš„åŸŸå.com

# æ›´æ–°å®‰å…¨ç»„ä»¥æ”¯æŒHTTPS
aws ec2 authorize-security-group-ingress \
  --group-id ä½ çš„å®‰å…¨ç»„ID \
  --protocol tcp \
  --port 443 \
  --cidr 0.0.0.0/0
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. å¯†é’¥å¯¹æœªæ‰¾åˆ°
```
é”™è¯¯: åœ¨åŒºåŸŸ 'us-east-1' ä¸­æœªæ‰¾åˆ°å¯†é’¥å¯¹ 'my-keypair'
```
**è§£å†³æ–¹æ¡ˆ**: åˆ›å»ºå¯†é’¥å¯¹æˆ–ä½¿ç”¨ç°æœ‰çš„:
```bash
aws ec2 create-key-pair --key-name æˆ‘çš„å¯†é’¥å¯¹ --region us-east-1
```

#### 2. æƒé™ä¸è¶³
```
é”™è¯¯: ç”¨æˆ·æ— æƒæ‰§è¡Œ: cloudformation:CreateStack
```
**è§£å†³æ–¹æ¡ˆ**: æ·»åŠ æ‰€éœ€IAMæƒé™æˆ–ä½¿ç”¨ç®¡ç†å‘˜è®¿é—®æƒé™ã€‚

#### 3. å®ä¾‹æ— å“åº”
```
curl: (7) æ— æ³•è¿æ¥åˆ°IPç«¯å£80: è¿æ¥è¢«æ‹’ç»
```
**è§£å†³æ–¹æ¡ˆ**:
- ç­‰å¾…2-3åˆ†é’Ÿå®Œæˆåˆå§‹åŒ–
- æ£€æŸ¥å®‰å…¨ç»„è§„åˆ™
- éªŒè¯å®ä¾‹æ­£åœ¨è¿è¡Œ
- æ£€æŸ¥åº”ç”¨æ—¥å¿—

#### 4. S3è®¿é—®è¢«æ‹’ç»
```
é”™è¯¯: è®¿é—®S3æ¡¶æ—¶è¢«æ‹’ç»
```
**è§£å†³æ–¹æ¡ˆ**:
- éªŒè¯IAMè§’è‰²æƒé™
- æ£€æŸ¥æ¡¶ç­–ç•¥
- ç¡®ä¿å®ä¾‹é…ç½®æ–‡ä»¶å·²é™„åŠ 

### è°ƒè¯•å‘½ä»¤

```bash
# æ£€æŸ¥CloudFormationå †æ ˆçŠ¶æ€
aws cloudformation describe-stacks --stack-name ä½ çš„å †æ ˆåç§°

# æ£€æŸ¥å®ä¾‹çŠ¶æ€
aws ec2 describe-instances --instance-ids ä½ çš„å®ä¾‹ID

# SSHåˆ°å®ä¾‹è¿›è¡Œè°ƒè¯•
ssh -i ä½ çš„å¯†é’¥å¯¹.pem ec2-user@ä½ çš„å®ä¾‹IP

# æ£€æŸ¥åº”ç”¨æ—¥å¿—
sudo journalctl -u s3-proxy -f

# æ£€æŸ¥nginxæ—¥å¿—
sudo tail -f /var/log/nginx/s3-proxy-error.log

# æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
sudo systemctl status nginx s3-proxy
```

## ğŸ”„ æ›´æ–°å’Œç»´æŠ¤

### æ›´æ–°åº”ç”¨ä»£ç 

```bash
# SSHåˆ°å®ä¾‹
ssh -i ä½ çš„å¯†é’¥å¯¹.pem ec2-user@ä½ çš„å®ä¾‹IP

# å¤‡ä»½å½“å‰ç‰ˆæœ¬
sudo cp /opt/s3-proxy/s3-proxy.py /opt/s3-proxy/s3-proxy.py.backup

# æ›´æ–°ä»£ç  (æ‰‹åŠ¨ç¼–è¾‘æˆ–ä¸‹è½½æ–°ç‰ˆæœ¬)
sudo nano /opt/s3-proxy/s3-proxy.py

# é‡å¯æœåŠ¡
sudo systemctl restart s3-proxy
```

### æ›´æ–°åŸºç¡€è®¾æ–½

```bash
# æ›´æ–°CloudFormationå †æ ˆ
aws cloudformation deploy \
  --template-file infrastructure/cloudformation-template.yaml \
  --stack-name ä½ çš„å †æ ˆåç§° \
  --parameter-overrides KeyPairName=ä½ çš„å¯†é’¥å¯¹ \
  --capabilities CAPABILITY_NAMED_IAM
```

### å¤‡ä»½å’Œæ¢å¤

```bash
# å¤‡ä»½S3å†…å®¹
aws s3 sync s3://ä½ çš„æ¡¶åç§°/ ./backup/

# å¤‡ä»½åº”ç”¨é…ç½®
scp -i ä½ çš„å¯†é’¥å¯¹.pem ec2-user@ä½ çš„IP:/opt/s3-proxy/s3-proxy.py ./backup/

# ä»å¤‡ä»½æ¢å¤
aws s3 sync ./backup/ s3://ä½ çš„æ¡¶åç§°/
```

## ğŸ—‘ï¸ æ¸…ç†

### å®Œæ•´æ¸…ç†

```bash
# åˆ é™¤CloudFormationå †æ ˆ (åˆ é™¤æ‰€æœ‰èµ„æº)
aws cloudformation delete-stack \
  --stack-name ä½ çš„å †æ ˆåç§° \
  --region ä½ çš„åŒºåŸŸ

# éªŒè¯åˆ é™¤
aws cloudformation describe-stacks \
  --stack-name ä½ çš„å †æ ˆåç§° \
  --region ä½ çš„åŒºåŸŸ
# åº”è¯¥è¿”å›: å †æ ˆä¸å­˜åœ¨
```

### éƒ¨åˆ†æ¸…ç† (ä¿ç•™S3æ•°æ®)

```bash
# é¦–å…ˆä¸‹è½½S3å†…å®¹
aws s3 sync s3://ä½ çš„æ¡¶åç§°/ ./backup/

# åˆ é™¤å †æ ˆ
aws cloudformation delete-stack --stack-name ä½ çš„å †æ ˆåç§°

# å°†S3å†…å®¹æ¢å¤åˆ°æ–°éƒ¨ç½²
aws s3 sync ./backup/ s3://æ–°æ¡¶åç§°/
```

## ğŸ“ æ”¯æŒ

- **æ–‡æ¡£**: æŸ¥çœ‹ `/docs` ç›®å½•
- **é—®é¢˜åé¦ˆ**: GitHub Issues
- **ç¤¾åŒºè®¨è®º**: GitHub Discussions

---

**ä¸‹ä¸€æ­¥**: éƒ¨ç½²æˆåŠŸåï¼Œè¯·æŸ¥çœ‹ [APIæ–‡æ¡£.md](APIæ–‡æ¡£.md) äº†è§£APIä½¿ç”¨æ–¹æ³•ï¼ŒæŸ¥çœ‹ [æ•…éšœæ’é™¤.md](æ•…éšœæ’é™¤.md) äº†è§£å¸¸è§é—®é¢˜ã€‚
